/*
* sliderControl
* 
*     touch slider input control for mobile WebKit
*     (also works on desktop webkit browsers for testing/dev purposes) 
* 
* Copyright (c) 2010 
* http://42at.com/lab/sliderControl
* Released under MIT license
* 
* Version 0.1a - Last updated: 2010.03.11
*/
(function(){window.sliderControl=c;window.slideToAction=d;function c(g,i,n){var k=this;var f=n||{};var h=arguments.length;this.valuesFnc=null;if(i instanceof Array){this.values=i}else{if(h>4){f=arguments[4];this.values=b(arguments[1],arguments[2],arguments[3])}else{if(h==4){f=typeof arguments[3]=="object"?arguments[3]:null;this.values=b(arguments[1],arguments[2],f?1:arguments[3])}else{if(h==3){f=typeof arguments[2]=="object"?arguments[2]:null;if(f){if(typeof arguments[1]!="function"){this.values=b(1,arguments[1],1)}else{this.valuesFnc=arguments[1];this.values=b(0,100,1)}}else{this.values=b(arguments[1],arguments[2],1)}}else{if(h==2){f=typeof arguments[1]=="object"?arguments[1]:null;if(f||typeof arguments[1]=="function"){this.values=b(0,100,1)}else{if(typeof arguments[1]!="function"){this.values=b(1,arguments[1],1)}else{this.valuesFnc=arguments[1]}}}else{this.values=b(0,100,1)}}}}}this.options=f||{};for(var j in c.options.defaults){if(this.options[j]===undefined){this.options[j]=c.options.defaults[j]}}if(this.options.hints&&typeof this.options.hints=="string"){this.options.hints=this.options.hints.split("|")}this.wrapper=document.querySelector(g);this.thumb=null;this.$value=document.querySelector(this.options.valueSelector);this.labelsDiv=null;this.valueIndex=0;this.startIndex=-1;this.moving=false;this.value=this.values?this.values[this.valueIndex]:null;this.percent=0;if(!this.thumb){var e=document.createElement("div");e.className=this.options.thumbClass;this.thumb=this.wrapper.appendChild(e)}this.wrapper.className+=" "+this.options.sliderClass;for(var m in this.options.sliderCss){this.wrapper.style[m]=this.options.sliderCss[m]}for(var m in this.options.thumbCss){this.thumb.style[m]=this.options.thumbCss[m]}this.thumb.webkitTransitionProperty="-webkit-transform";this.thumb.style.webkitTransitionTimingFunction=this.options.easing;this.thumb.style.webkitTransform="translate3d(0, 0, 0)";this.thumb.addEventListener(window.Touch?"touchstart":"mousedown",this,true);this.numberOfTouches=1;if(this.options.labels){a(this)}if(this.options.slideToClick||this.options.enableToggle){this.wrapper.addEventListener("click",this,true)}if(typeof window.orientation!="undefined"){document.body.addEventListener("orientationchange",this,true)}this.refresh();if(typeof this.options.initialValue!="undefined"){if(this.options.initialValue!==null){this.valueIndex=-1;this.setValue(this.options.initialValue)}}else{this.setIndex(0)}if(this.options.disabled){this.disable()}}c.options={defaults:{easing:"ease-out",easingDuration:150,labels:false,slideToClick:true,enableSnap:true,enableToggle:false,hints:null,disabled:false,valueSelector:".sliderValue",sliderClass:"slider",thumbClass:"sliderThumb",labelClass:"sliderLabel",selectedClass:"selected",labelsDivClass:"sliderLabelsDiv",disabledClass:"sliderDisabled",sliderCss:{},thumbCss:{},labelWidthAdjust:1,onslidebegin:null,onslide:null,onslideend:null,onchange:null,onclick:null,dummy:null}};c.prototype={slide:function(f,e){if(typeof this.options.onslide=="function"){return this.options.onslide.apply(this,arguments)}if(e&&this.$value){this.$value.innerHTML=this.options.hints?this.options.hints[this.valueIndex]:this.value}},change:function(){if(typeof this.options.onchange=="function"){return this.options.onchange.apply(this,arguments)}},slideend:function(){if(typeof this.options.onslideend=="function"){return this.options.onslideend.apply(this,arguments)}},slidebegin:function(){if(typeof this.options.onslidebegin=="function"){return this.options.onslidebegin.apply(this,arguments)}},click:function(){if(typeof this.options.onclick=="function"){return this.options.onclick.apply(this,arguments)}return true},getValue:function(){return this.value},getIndex:function(){return this.valueIndex},setValue:function(f){if(typeof f!="undefined"&&this.values){for(var e in this.values){if(f==this.values[e]){this.setIndex(e);break}}}return this.value},setIndex:function(f){if(typeof f!="undefined"&&this.values&&f>=0&&f<this.values.length){var g=this.percentAtIndex(f),h=Math.floor(this.maxSlide*g/100);if(f!=this.valueIndex){var e=this.position();this.valueIndex=f>>0;this.value=this.values[f];this.triggerCallback("slide",h-e,true);this.change()}this.slideTo(g)}return this.valueIndex},toggle:function(){var e=this.valueIndex;if(e<this.values.length-1){e++}else{e=0}this.setIndex(e);return this.value},next:function(g){g=typeof g=="undefined"?1:g;var f=this.valueIndex,e=this.values.length-1;if(f+g>e||f+g<0){return null}this.setIndex(f+g);return this.value},prev:function(e){e=typeof e=="undefined"?1:e;return this.next(-e)},first:function(){this.setIndex(0);return this.value},last:function(){this.setIndex(this.values.length-1);return this.value},disable:function(){this.disabled=true;this.wrapper.className+=" "+this.options.disabledClass},enable:function(){this.disabled=false;this.wrapper.className=this.wrapper.className.replace(new RegExp("\\b"+this.options.disabledClass+"\\b","g"),"")},destroy:function(){this.destroyLabels();if(this.thumb){this.thumb.removeEventListener(window.Touch?"touchstart":"mousedown",this,true);this.wrapper.removeChild(this.thumb);this.thumb=null}if(this.options.slideToClick||this.options.enableToggle){this.wrapper.removeEventListener("click",this,true)}if(typeof window.orientation!="undefined"){document.body.removeEventListener("orientationchange",this,true)}for(var e in this.options.sliderCss){this.wrapper.style[e]=""}if(this.$value){this.$value.innerHTML=""}this.wrapper=null;this.$value=null},percentAtIndex:function(e){if(!this.values){return 0}var g=this.values.length;var f=Math.floor(e*(100/(g-1||1)));return f},indexFromPos:function(f){if(!this.values){return 0}if(f<0){f=0}var g=this.values.length;var e=Math.round((g-1)*f/this.maxSlide);return e},triggerCallback:function(g){var f=this,e=[].slice.call(arguments);e.shift();setTimeout(function(){f[g].apply(f,e)},0)},handleEvent:function(f){if(this.disabled){return}switch(f.type){case"touchstart":case"mousedown":this.onTouchStart(f);break;case"touchmove":case"mousemove":this.onTouchMove(f);break;case"touchend":case"mouseup":this.onTouchEnd(f);break;case"click":if(!this.click(f)){return}if(!this.moving&&this.options.slideToClick&&f.target!=this.thumb){this.onClick(f)}else{if(this.options.enableToggle){this.toggleOnClick(f)}}this.moving=false;break;case"orientationchange":this.onOrientation(f);break;case"webkitTransitionEnd":this.onTransitionEnd(f);break}},position:function(e){if(typeof e!="undefined"){this._position=e;this.percent=Math.floor(e/this.maxSlide*100);this.thumb.style.webkitTransform="translate3d("+e+"px, 0, 0)"}return this._position},refresh:function(){this.thumb.style.webkitTransitionDuration="0";this.wrapperWidth=this.wrapper.clientWidth;this.maxSlide=this.wrapper.clientWidth-this.thumb.offsetWidth-parseInt(getComputedStyle(this.wrapper,null).getPropertyValue("padding-left"))-parseInt(getComputedStyle(this.wrapper,null).getPropertyValue("padding-right"))},onClick:function(h){var f=h.clientX;f-=this.wrapper.offsetLeft+this.thumb.offsetWidth/2;var g=this.indexFromPos(f);this.startIndex=this.valueIndex;if(g!=this.valueIndex){this.setIndex(g)}},toggleOnClick:function(f){if(this.moving||f.target!=this.thumb){return false}this.toggle()},destroyLabels:function(){if(!this.labelsDiv){return}var e=this.labelsDiv;while(e.firstChild){e.removeChild(e.firstChild)}e.parentNode.removeChild(e)},onOrientation:function(f){if(this.wrapperWidth!=this.wrapper.clientWidth){this.destroyLabels();a(this);this.setIndex(this.valueIndex)}else{this.refresh()}},onTouchStart:function(f){if(window.Touch&&f.targetTouches.length!=this.numberOfTouches){return}this.moving=false;if(this.values){this.startIndex=this.valueIndex}this.startX=window.Touch?f.targetTouches[0].clientX:f.clientX;this.thumb.addEventListener(window.Touch?"touchmove":"mousemove",this,false);this.thumb.addEventListener(window.Touch?"touchend":"mouseup",this,false);this.triggerCallback("slidebegin");return false},onTouchMove:function(k){if(window.Touch&&k.targetTouches.length!=this.numberOfTouches){return}k.preventDefault();var f=window.Touch?k.targetTouches[0].clientX:k.clientX;var j=window.getComputedStyle(this.thumb).webkitTransform;j=new WebKitCSSMatrix(j).m41;var n=f-this.startX;if(n==0||(j<0&&n<0)||(j>this.maxSlide&&n>0)){return false}this.moving=true;var m=this.position(),h=Math.min(this.maxSlide,Math.max(m+n,0));this.position(h);this.startX=f;var l=true;if(this.values){var g=this.indexFromPos(h);if((l=g!=this.valueIndex)){this.value=this.valuesFnc?this.valuesFnc(g):this.values[g];this.valueIndex=g}}this.triggerCallback("slide",n,l);return false},onTouchEnd:function(j){this.thumb.removeEventListener(window.Touch?"touchmove":"mousemove",this,false);this.thumb.removeEventListener(window.Touch?"touchend":"mouseup",this,false);var g=this;if(this.valueIndex!=this.startIndex||(this.values.length==1&&this.percent>99)){this.triggerCallback("change")}if(this.moving&&(!this.options.enableSnap||this.options.easingDuration==0)){this.triggerCallback("slideend")}if(!this.moving||!this.options.enableSnap){this.updateSelected()}else{var k=this.position();if(this.values){var f=this.indexFromPos(k);var h=this.percentAtIndex(f);this.slideTo(h)}}return false},onTransitionEnd:function(){this.thumb.style.webkitTransitionDuration="0";this.thumb.removeEventListener("webkitTransitionEnd",this,false);this.triggerCallback("slideend")},slideTo:function(e){this.thumb.style.webkitTransitionTimingFunction=this.options.easing;this.thumb.style.webkitTransitionDuration=this.options.easingDuration+"ms";this.thumb.addEventListener("webkitTransitionEnd",this,false);var f=Math.floor(this.maxSlide*e/100);this.position(f);this.updateSelected();return},updateSelected:function(){if(this.startIndex!=this.valueIndex&&this.options.selectedClass&&this.labelsDiv){var e=this.labelsDiv.querySelector("."+this.options.selectedClass);if(e){e.className=e.className.replace(new RegExp("\\b"+this.options.selectedClass+"\\b","g"),"")}if(this.labelsDiv.childNodes.length>this.valueIndex){this.labelsDiv.childNodes[this.valueIndex].className+=" "+this.options.selectedClass}}}};c.range=b;function b(k,f,i){var e=arguments.length;if(e==0){return[]}if(e==1){return arguments.callee(0,k,1)}if(e==2){return arguments.callee(k,f,1)}var g=[];if(i==0){return[]}if((k<=f&&i<0)||(k>=f&&i>0)){i=-i}var j=-1;var h=i.toString().indexOf(".");if(h!=-1){j=i.toString().length-(1+h);h=true}else{k>>=0;f>>=0;i>>=0;h=false}for(;i>0?k<=f:k>=f;k+=i){g.push(h?parseFloat(k.toFixed(j)):k)}return g}function a(f){var l=f.options.labels;switch(typeof l){case"boolean":case"number":l=f.values;break;case"string":l=l.split(/\|/);if(l.length!=f.values.length){l=new Array(f.values.length+1).join(l+"\u0000").split("\u0000",f.values.length)}break}if(!l.length){return}var k=document.createElement("div");k.className=f.options.labelsDivClass;f.labelsDiv=f.wrapper.appendChild(k);var h="",i=f.values.length>1?f.values.length:l.length,e=Math.floor(f.wrapper.clientWidth/f.values.length)-f.options.labelWidthAdjust;if(f.values.length>1){f.thumb.style.width=e+"px"}f.refresh();for(var g in l){h+='<span class="'+f.options.labelClass+'" style="width:'+e+'px;">'+l[g]+"</span>"}f.labelsDiv.innerHTML=h}function d(h,k,g){var e={labels:true,selectedClass:"",sliderClass:"sliderAction",thumbCss:{width:"60px"},onslide:function(l){var i=this.labelsDiv;i.style.webkitTransitionProperty="opacity";i.style.webkitTransitionDuration="50ms";i.style.opacity=Math.max(0,1-this.percent/50)},onchange:function(){alert("override onchange callback to do something semi-useful!")},onslideend:function(){var i=this.labelsDiv;i.style.opacity=1},thumbLabel:""};for(var f in g){e[f]=g[f]}var j=new c(h,[k],e);j.thumb.innerHTML=e.thumbLabel;return j}})();